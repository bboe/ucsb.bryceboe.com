<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/public/variant-multi.css" title="Variant Multi" media="all" />
    <link rel="stylesheet" type="text/css" href="/public/monokai.sublime.css" />
    <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />
    <title>Bourne Shell Scripting &raquo; CS32 Summer 2012</title>
  </head>
  <body>
    <div id="container980">
<div id="header">
  <h1><a href="/cs32_m12/">Computer Science 32, Summer 2012</a></h1>
  <h2>Object-Oriented Design and Implementation</h2>
</div>

<div id="menu">
  <ul>
    <li><a href="/cs32_m12/schedule">lecture schedule</a></li>
    <li><a href="/cs32_m12/automated_feedback">automated feedback</a></li>
    <li><a href="/cs32_m12/bourne">bourne shell scripting</a></li>
  </ul>
</div>

<div id="main">
  <div id="sidebar">
    <div class="sidebarbox">
      <h2>People &amp; Office Hours</h2>
      <ul>
        <li><strong>Instructor</strong>: Bryce Boe
          (<a href="/">web</a>, <a href="mailto:bboe@cs.ucsb.edu">email</a>)
          <ul>
            <li>Monday, 14:15 - 15:15 in GSL</li>
            <li>Wednesday, 11:15 - 12:15 in GSL</li>
          </ul>
        </li>
        <li><strong>TA</strong>: Saeed Mahani
          <ul>
            <li>Tuesday, 14:00 - 15:00 in CSIL</li>
            <li>Thursday, 13:00 - 14:00 in CSIL</li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="sidebarbox">
      <h2>Tentative Deadlines</h2>
      <h3>All deadlines are at 23:59:59 on the due date.</h3>
      <ul>
        <li>2012/08/06 -- <a href="/cs32_m12/hw1">Homework 1</a></li>
        <li>2012/08/09 -- <a href="/cs32_m12/lab1">Lab 1</a></li>
        <li>2012/08/10 -- Drop with Refund</li>
        <li>2012/08/12 -- <a href="/cs32_m12/hw2">Homework 2</a></li>
        <li>2012/08/16 -- <a href="/cs32_m12/lab2">Lab 2</a></li>
        <li>2012/08/19 -- <a href="/cs32_m12/project1_part1">Project 1, Part 1</a></li>
        <li>2012/08/23 -- <a href="/cs32_m12/lab3">Lab 3</a></li>
        <li>2012/08/26 -- <a href="/cs32_m12/project1_part2">Project 1, Part 2</a></li>
        <li>2012/08/30 -- <a href="/cs32_m12/lab4">Lab 4</a></li>
        <li>2012/09/06 -- <a href="/cs32_m12/lab5">Lab 5</a></li>
        <li>2012/09/13 -- <a href="/cs32_m12/project2">Project 2</a></li>
      </ul>
    </div>
  </div>

  <div id="content">
<h2 id="an-introduction-to-bourne-shell-scripting">An introduction to bourne shell scripting</h2>

<p>The bourne shell appears to be the most widely distributed shell available on
unix-based systems. While it is not as powerful as newer shells such as bash
(bourne again shell) or csh, we will write bourne shell scripts for their
portability and its compatability with many modern shells.</p>

<p>A bourne shell script is simply a plain text file that contains commands you
might normally run in the bourne shell in addition to a few other useful
constructs we are famililar with from C and C++. In this document, we will
demonstrate each of the following features with simple bourne shell script
examples:</p>

<ul>
  <li>Command line arguments</li>
  <li>String concatenation</li>
  <li>Variable assignment and usage</li>
  <li>Conditionals</li>
  <li>Loops</li>
</ul>

<p>For a more complete reference please see the
<a href="https://www.ooblick.com/text/sh/">Bourne Shell Programming</a> page provided by
ooblick.com.</p>

<h3 id="hello-world">Hello World</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello world"</span>
</code></pre></div></div>

<p>The first line, <code class="language-plaintext highlighter-rouge">#!/bin/sh</code>, tells the operating system that the file should be
processed with the executable /bin/sh. If this line is omitted, then whatever
script is responsible for launching the shell script will execute the commands.</p>

<p>On the second line we tell the program to invoke the external command <code class="language-plaintext highlighter-rouge">echo</code>
with the argument “Hello world”.</p>

<p>Save the above as <code class="language-plaintext highlighter-rouge">example.sh</code> and perform the following tasks (you’ll want to
follow this proceedure for all examples):</p>

<ol>
  <li>Execute the command <code class="language-plaintext highlighter-rouge">chmod +x example.sh</code> to mark the script as executable</li>
  <li>Run the script by typing the command <code class="language-plaintext highlighter-rouge">./example.sh</code></li>
</ol>

<p>You can also run the script via the command <code class="language-plaintext highlighter-rouge">sh hello.sh</code>. Doing so does not
require the script to be executable, and will ignore the <code class="language-plaintext highlighter-rouge">#!/bin/sh</code> line at
the top of the script. This is useful if you want to run the script in a
different shell wihtout modifing the script contents: <code class="language-plaintext highlighter-rouge">bash hello.sh</code>.</p>

<h3 id="command-line-arguments-and-string-concatenation">Command line arguments and string concatenation</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"All arguments: </span><span class="nv">$*</span><span class="s2">"</span>   <span class="c"># Doesn't include the script name</span>
<span class="nb">echo</span> <span class="s2">"Script name: </span><span class="nv">$0</span><span class="s2">"</span>     <span class="c"># Output the script name</span>
<span class="nb">echo</span> <span class="s2">"First argument: </span><span class="nv">$1</span><span class="s2">"</span>  <span class="c"># Output the first command line argument</span>
<span class="nb">echo</span> <span class="s2">"Num args: $#"</span>        <span class="c"># Output the number of arguments</span>
</code></pre></div></div>

<p>If you run the above script via <code class="language-plaintext highlighter-rouge">example.sh a b c</code> you should see the following
output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>All arguments: a b c
Script name: ./example.sh
First argument: a
Num args: 3
</code></pre></div></div>

<p>Take note that <code class="language-plaintext highlighter-rouge">$*</code> doesn’t include the script name <code class="language-plaintext highlighter-rouge">$0</code> and that this argument
is not counted in <code class="language-plaintext highlighter-rouge">$#</code>. This differs from the <code class="language-plaintext highlighter-rouge">int argc, char *argv[]</code>
parameters for C/C++ programs which do count argv[0] as an argument. Also
notice that we are referring to variables from within the strings, in spite of
whatever type that variable holds.</p>

<h3 id="variables-and-capturing-external-commands-output">Variables and capturing external commands’ output</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nv">msg_string</span><span class="o">=</span><span class="s2">"Path to script:"</span>
<span class="nv">prog_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$0</span><span class="si">)</span> <span class="c"># Assign the output of the command "basename $0"</span>
                         <span class="c"># to the variable prog_name</span>
<span class="nv">cur_directory</span><span class="o">=</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>     <span class="c"># Do something similiar with pwd</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$msg_string</span><span class="s2">: </span><span class="nv">$cur_directory</span><span class="s2">/</span><span class="nv">$prog_name</span><span class="s2">"</span>
</code></pre></div></div>

<p>In the above example, we see three examples of variable assignment. On line
two, we directly assign a string to the variable <code class="language-plaintext highlighter-rouge">msg_string</code>. Note that we do
not use <code class="language-plaintext highlighter-rouge">$</code> when assigning a value to a variable. However, the <code class="language-plaintext highlighter-rouge">$</code> must be used
when attempting to recall the stored value.</p>

<p>It is also important to know that the <strong>lack</strong> of whitespace around <code class="language-plaintext highlighter-rouge">=</code> is very
important. An <code class="language-plaintext highlighter-rouge">=</code> character surrounded by whitespace has a completely different
meaning (comparision) in bourne shell scripting.</p>

<p>On lines 3 and 5, we see the usage of $(<em>COMMAND LINE</em>). This syntax is used to
execute the command between the <code class="language-plaintext highlighter-rouge">( )</code> and capture its output. In this case, we
use the program <code class="language-plaintext highlighter-rouge">basename</code> to convert <code class="language-plaintext highlighter-rouge">./example.sh</code> into <code class="language-plaintext highlighter-rouge">example.sh</code> and the
program <code class="language-plaintext highlighter-rouge">pwd</code> to tell us our present working directory. We store the results of
those commands in the variables <code class="language-plaintext highlighter-rouge">prog_name</code> and <code class="language-plaintext highlighter-rouge">cur_directory</code> respectively.</p>

<p>Finally, on line 6, we demonstrate another example of string concatenation,
this time combining three separate variables into a single string.</p>

<h3 id="conditionals">Conditionals</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"There are command line arguments"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"There are no command line arguments"</span>
<span class="k">fi</span>
</code></pre></div></div>

<p>In the above example, we demonstrate the use of an if/else conditional on the
condition that the number of arguments does not equal zero. Again, please note
that whitespace is crucial in some places. Here the whitespace after <code class="language-plaintext highlighter-rouge">[</code> and
before <code class="language-plaintext highlighter-rouge">]</code> are necessary.</p>

<p>In addition to the typical number comparision operators (<code class="language-plaintext highlighter-rouge">eq</code>, <code class="language-plaintext highlighter-rouge">ne</code>, <code class="language-plaintext highlighter-rouge">gt</code>,
<code class="language-plaintext highlighter-rouge">ge</code>, <code class="language-plaintext highlighter-rouge">lt</code>, <code class="language-plaintext highlighter-rouge">le</code>), bourne shell also allows for the testing of paths to check
if the path points to a regular file, <code class="language-plaintext highlighter-rouge">-f</code>, a directory, <code class="language-plaintext highlighter-rouge">-d</code>, or a few
others. In the following example, we confirm that our current directory, <code class="language-plaintext highlighter-rouge">.</code>, is, in
fact, a directory and not a file.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="nb">.</span> <span class="nt">-a</span> <span class="o">!</span> <span class="nt">-f</span> <span class="nb">.</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">". is in fact a directory and not a file."</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"This should never be true."</span>
<span class="k">fi</span>
</code></pre></div></div>

<p>In the above conditional, I introduced the <em>logical and</em>, <code class="language-plaintext highlighter-rouge">-a</code>, between two
independent conditions, <code class="language-plaintext highlighter-rouge">-d .</code> and <code class="language-plaintext highlighter-rouge">! -f .</code>. The <code class="language-plaintext highlighter-rouge">!</code> preceding the second
condition is the <em>logical negation</em>.</p>

<h3 id="basic-looping">Basic Looping</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="k">for </span>filename <span class="k">in</span> <span class="si">$(</span><span class="nb">ls</span><span class="si">)</span><span class="p">;</span> <span class="k">do
    </span><span class="nb">echo</span> <span class="nv">$filename</span>
<span class="k">done</span>
</code></pre></div></div>

<p>In the above example, we loop over the list of filenames in the current
directory as reported by the command <code class="language-plaintext highlighter-rouge">ls</code>. The variable <code class="language-plaintext highlighter-rouge">filename</code> holds the
result of the current iteration.</p>

<p>This example is as much detail as I will provide on looping in bourne scripts
as it should be all that’s needed for this class. I do, however, want to make a
note that looping over files in this manor does not work if a filename has a
space character in it. For more on this issue, please see <a href="https://www.cyberciti.biz/tips/handling-filenames-with-spaces-in-bash.html">this
resource</a>.</p>

  </div>
  <div class="clear">&nbsp;</div>
</div>

      <div id="credits">
        <p><span class="small">Template design by <a href="https://andreasviklund.com/">Andreas Viklund</a></span></p>
      </div>
    </div>
  </body>
</html>
