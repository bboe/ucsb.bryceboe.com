<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/public/variant-multi.css" title="Variant Multi" media="all" />
    <link rel="stylesheet" type="text/css" href="/public/monokai.sublime.css" />
    <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />
    <title>Lab 5 &raquo; CS32 Summer 2012</title>
  </head>
  <body>
    <div id="container980">
<div id="header">
  <h1><a href="/cs32_m12/">Computer Science 32, Summer 2012</a></h1>
  <h2>Object-Oriented Design and Implementation</h2>
</div>

<div id="menu">
  <ul>
    <li><a href="/cs32_m12/schedule">lecture schedule</a></li>
    <li><a href="/cs32_m12/automated_feedback">automated feedback</a></li>
    <li><a href="/cs32_m12/bourne">bourne shell scripting</a></li>
  </ul>
</div>

<div id="main">
  <div id="sidebar">
    <div class="sidebarbox">
      <h2>People &amp; Office Hours</h2>
      <ul>
        <li><strong>Instructor</strong>: Bryce Boe
          (<a href="/">web</a>, <a href="mailto:bboe@cs.ucsb.edu">email</a>)
          <ul>
            <li>Monday, 14:15 - 15:15 in GSL</li>
            <li>Wednesday, 11:15 - 12:15 in GSL</li>
          </ul>
        </li>
        <li><strong>TA</strong>: Saeed Mahani
          <ul>
            <li>Tuesday, 14:00 - 15:00 in CSIL</li>
            <li>Thursday, 13:00 - 14:00 in CSIL</li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="sidebarbox">
      <h2>Tentative Deadlines</h2>
      <h3>All deadlines are at 23:59:59 on the due date.</h3>
      <ul>
        <li>2012/08/06 -- <a href="/cs32_m12/hw1">Homework 1</a></li>
        <li>2012/08/09 -- <a href="/cs32_m12/lab1">Lab 1</a></li>
        <li>2012/08/10 -- Drop with Refund</li>
        <li>2012/08/12 -- <a href="/cs32_m12/hw2">Homework 2</a></li>
        <li>2012/08/16 -- <a href="/cs32_m12/lab2">Lab 2</a></li>
        <li>2012/08/19 -- <a href="/cs32_m12/project1_part1">Project 1, Part 1</a></li>
        <li>2012/08/23 -- <a href="/cs32_m12/lab3">Lab 3</a></li>
        <li>2012/08/26 -- <a href="/cs32_m12/project1_part2">Project 1, Part 2</a></li>
        <li>2012/08/30 -- <a href="/cs32_m12/lab4">Lab 4</a></li>
        <li>2012/09/06 -- <a href="/cs32_m12/lab5">Lab 5</a></li>
        <li>2012/09/13 -- <a href="/cs32_m12/project2">Project 2</a></li>
      </ul>
    </div>
  </div>

  <div id="content">
<h2 id="lab-5-inspecting-objectload-modules">Lab 5, Inspecting object/load modules</h2>

<h3 id="goals-for-this-lab">Goals for this lab</h3>

<p>By the time you have completed this lab you should be able to:</p>

<ul>
  <li>Identify and interpret file types with the file command.</li>
  <li>Inspect object and load module contents and structure with command line tools
<code class="language-plaintext highlighter-rouge">strings</code>, <code class="language-plaintext highlighter-rouge">nm</code>, <code class="language-plaintext highlighter-rouge">objdump</code> and <code class="language-plaintext highlighter-rouge">readelf</code>.</li>
  <li>Explain key memory concepts for C and C++ programs.</li>
</ul>

<h3 id="pairing-reminder">Pairing Reminder</h3>

<p>You must work as a pair on the labs. If you were paired up last week, you need
to work with the same pair. If you did not get paired up last week, or your
pair is no longer in the class, please see the TA.</p>

<h3 id="lab-preparation">Lab Preparation</h3>

<p>Change into the cs32 directory, and create a lab directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd cs32
mkdir lab5
</code></pre></div></div>

<p>Change into the lab4 directory and copy the file you will need for this lab:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd lab5
cp ~cs32/public_html/code/lab5/* .
</code></pre></div></div>

<h3 id="compile-link-separately-and-begin-exploring-the-binaries">Compile, link separately, and begin exploring the binaries</h3>

<p>First compile with both -g and -c flags to provide debugging information and
write the object module, lab5.o to disk:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clang++ -g -c lab5.cpp
</code></pre></div></div>

<p>Now create the executable file from this object file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clang++ -o lab5 lab5.o
</code></pre></div></div>

<p>Next, read and interpret the output of the file command for the three
files. Executing <code class="language-plaintext highlighter-rouge">file lab5*</code> will produce the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lab5:     ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, not stripped
lab5.cpp: ASCII text
lab5.o:   ELF 32-bit LSB relocatable, Intel 80386, version 1 (GNU/Linux), not stripped
</code></pre></div></div>

<p>ELF stands for “Executable and Linking Format” as you learned from the Reader
and lecture, LSB means “Linux Standard Base” (a collection of APIs meant to be
supported by all Linux systems), and SYSV abbreviates “UNIX System V.” What
else can you learn from these results? And what do you suppose “not stripped”
means?</p>

<p>The strings command can be used to list the strings in a binary file. For
example, the relocatable object file (lab5.o) has two strings:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ strings lab5.o
element 
 is 
</code></pre></div></div>

<p>Did you read the source code? If so, then these strings should look
familiar. Meanwhile, the executable file contains many more strings. Try
<code class="language-plaintext highlighter-rouge">strings lab5</code> to see them.</p>

<h3 id="inspect-object-module-namessections-with-nm">Inspect object module names/sections with <code class="language-plaintext highlighter-rouge">nm</code></h3>

<p>The command <code class="language-plaintext highlighter-rouge">nm</code> lists the “names” (symbols) in an object or load module, and
<code class="language-plaintext highlighter-rouge">objdump</code> displays various information about such files. Both commands have
useful options that are worth learning.</p>

<p>Show the names in lab5.o via <code class="language-plaintext highlighter-rouge">nm lab5.o</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00000130 t _GLOBAL__I_a
         U _ZNSolsEPFRSoS_E
         U _ZNSolsEi
         U _ZNSt8ios_base4InitC1Ev
         U _ZNSt8ios_base4InitD1Ev
         U _ZSt4cout
         U _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_
00000028 b _ZStL8__ioinit
         U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc
00000028 d _ZZ4mainE1k
         U __cxa_atexit
00000000 t __cxx_global_var_init
         U __dso_handle
00000000 D a
00000000 B b
00000050 T main
</code></pre></div></div>

<p>The values on the left side are addresses in hexadecimal, and you can show
these values in decimal with the <code class="language-plaintext highlighter-rouge">-td</code> option. The next column shows the class
of each symbol, where <code class="language-plaintext highlighter-rouge">T</code> and <code class="language-plaintext highlighter-rouge">t</code> are functions, <code class="language-plaintext highlighter-rouge">D</code> and <code class="language-plaintext highlighter-rouge">d</code> are data (global
variables), B and b are uninitialized data, and U is undefined.</p>

<p>Notice the names are shown in their <code class="language-plaintext highlighter-rouge">mangled</code> form by default. For example,
<code class="language-plaintext highlighter-rouge">_ZZ4mainE1k</code> is really just the static variable <code class="language-plaintext highlighter-rouge">k</code> in <code class="language-plaintext highlighter-rouge">main</code>, <code class="language-plaintext highlighter-rouge">_ZNSolsEi</code>” is
<code class="language-plaintext highlighter-rouge">std::ostream::operator&lt;&lt;(int)</code> in more familiar notation. The <code class="language-plaintext highlighter-rouge">-C</code> option will
decode (demangle) such symbols for you. Try it now.</p>

<p>By the way, the default format for nm, “BSD format” is in some cases more
difficult to read than “System V format” which can be achieved with the <code class="language-plaintext highlighter-rouge">-f
sysv</code> option. Try that now too.</p>

<h3 id="inspect-object-module-namessections-with-objdump">Inspect object module names/sections with <code class="language-plaintext highlighter-rouge">objdump</code></h3>

<p>Using <code class="language-plaintext highlighter-rouge">objdump</code> can reveal more details about object files. At least one option
must be specified.</p>

<p>Try it first with the <code class="language-plaintext highlighter-rouge">-S</code> option. I recommend piping the results through
<code class="language-plaintext highlighter-rouge">less</code> to view one screenful at a time. Hit <code class="language-plaintext highlighter-rouge">q</code> when you want to exit <code class="language-plaintext highlighter-rouge">less</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>objdump -S lab5.o | less
</code></pre></div></div>

<p>According to <code class="language-plaintext highlighter-rouge">man</code>, the <code class="language-plaintext highlighter-rouge">-S</code> option will “display source code intermixed with
disassembly, if possible. Implies -d.” The <code class="language-plaintext highlighter-rouge">-d</code> option means disassemble the
code.</p>

<p>Use <code class="language-plaintext highlighter-rouge">man objdump</code> or read the <a href="https://sourceware.org/binutils/docs/binutils/objdump.html">man
 page</a> to
 learn about more options. You might like the <code class="language-plaintext highlighter-rouge">-l</code> option in particular. Use it
 along with the <code class="language-plaintext highlighter-rouge">-d</code> option as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>objdump -d -l lab5.o | less
</code></pre></div></div>

<p>Try some other option switches. Notice for example that <code class="language-plaintext highlighter-rouge">-C</code> serves the same
purpose it did for the <code class="language-plaintext highlighter-rouge">nm</code> command. Do you remember that purpose? The <code class="language-plaintext highlighter-rouge">-j</code>
option lets you specify <em>just</em> particular sections. Interesting sections
include <code class="language-plaintext highlighter-rouge">.text</code>, <code class="language-plaintext highlighter-rouge">.data</code>, <code class="language-plaintext highlighter-rouge">.rodata</code>, and <code class="language-plaintext highlighter-rouge">.ctors</code>, among others.</p>

<h3 id="inspect-executable-module-with-readelf">Inspect executable module with <code class="language-plaintext highlighter-rouge">readelf</code></h3>

<p>Although you could use <code class="language-plaintext highlighter-rouge">objdump</code> to inspect this load module, the <code class="language-plaintext highlighter-rouge">readelf</code>
tool gives more information about load modules (so called because they are
ready to be loaded into memory for execution). As with <code class="language-plaintext highlighter-rouge">objdump</code>, at least one
option must be specified.</p>

<p>First learn about <code class="language-plaintext highlighter-rouge">readelf</code> from its <a href="https://sourceware.org/binutils/docs/binutils/readelf.html">man
page</a>.</p>

<p>Did you notice that the <code class="language-plaintext highlighter-rouge">-S</code> option has a different meaning for <code class="language-plaintext highlighter-rouge">readelf</code> than
it does for <code class="language-plaintext highlighter-rouge">objdump</code>? For <code class="language-plaintext highlighter-rouge">readelf</code> it means “Displays the information
contained in the file’s section headers, if it has any.” Use it now to find out
the names of the sections in lab5:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>readelf -S lab5
</code></pre></div></div>

<h3 id="answer-some-questions">Answer some questions</h3>

<p>Create a file <code class="language-plaintext highlighter-rouge">answers.txt</code> and store your answers the following questions in
it. Place each answer on its own line and separate answers by at least a single
blank line:</p>

<ol>
  <li>
    <p>What is the name of the section with the program’s instructions?</p>
  </li>
  <li>
    <p>In what section is the array named <code class="language-plaintext highlighter-rouge">a</code> stored?</p>
  </li>
  <li>
    <p>What happened to the constant <code class="language-plaintext highlighter-rouge">M</code>? In what section is its value storred?</p>
  </li>
  <li>
    <p>In what section is the static variable <code class="language-plaintext highlighter-rouge">k</code> stored?</p>
  </li>
  <li>
    <p>How is the array <code class="language-plaintext highlighter-rouge">b</code> handled differently than other variables?</p>
  </li>
  <li>
    <p>The variable <code class="language-plaintext highlighter-rouge">i</code> is handled differently too. How?</p>
  </li>
</ol>

<h3 id="submission-instructions">Submission Instructions</h3>

<p>Please make only one submission per pair; this isn’t essential, it just makes
life easier for the TA.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~cs32/submit lab5@cs32 answers.txt
</code></pre></div></div>

<p>Please check the feedback email to ensure you submitted correctly. For this
lab, you will only receive a verification score (<code class="language-plaintext highlighter-rouge">0 out of 1</code> or <code class="language-plaintext highlighter-rouge">1 out of 1</code>)
to indicate that your submission was suitable for manual grading. Your actual
scores will be sent out via Piazza either Friday or Saturday following the lab.</p>

<h3 id="special-thanks">Special Thanks</h3>

<p>Special thanks to <a href="https://sites.cs.ucsb.edu/~mikec/">Michael Costanzo</a> for
allowing me use of his CS32 material. This lab was copied almost verbatim from
his Spring 2012 CS32 class.</p>

  </div>
  <div class="clear">&nbsp;</div>
</div>

      <div id="credits">
        <p><span class="small">Template design by <a href="https://andreasviklund.com/">Andreas Viklund</a></span></p>
      </div>
    </div>
  </body>
</html>
